---
title: "Modelling in R"
format: html
theme: sandstone
author-title: Made for
author: Bush Heritage
toc: true
toc-location: left
toc-title: Content
toc-depth: 4
published-title: Date
date: 2024-02-13
editor: visual
embed-resources: true
---

# Statistical modelling in R for ecologists

Whenever you embark on a journey in statistical modelling, it's good to be reminded of the following quote from *George E.P. Box*,

**All models are wrong, but some are useful**.

![Photograph of Geoge E.P. Box, "one of the great statistical minds of the 20th century"](Images/Box.jpeg)

We build models to help us understand ecological relationships. But no model is perfect. Ecological data in particular is fraught with a lot of random, natural variation in observations that our models will be unable to explain. 

Modelling goals can be three-fold: 

  1. **Exploration**, e.g. which environmental variables are associated with species richness?,
  
  2. **Inference**, e.g., do protected areas cause increased species richness?,
  
  3. **Prediction**, e.g., use correlations between environmental variables and species abundance to predict species habitat suitability across space.

How we build and select models depends on our goals for the analysis. Check out this great guide to [goal driven model selection in ecology](https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.3336)

Here, we will focus primarily on building exploratory and predictive models. Causal inference is beyond the scope, but see this great guide for ecologists [insert Arif paper]. We'll start with a basic linear model to explore how disturbance influences ecological characteristics across survey sites. We'll see how, depending on the type of data we are modelling, we might need use *generalised* linear models (as opposed to *general* linear models). We'll end with building complex spatial and multivariate models in **R**.

This course assumes an understanding of how to wrangle, summarise, and visualise data in **R**. We hope you will learn:

  - The fundamentals of fitting statistical models to data,
  
  - how to check your model fits the data well, and
  
  - how to understand and visualise model output in **R**.

## General linear models

We can use linear models to estimate the strength and direction of ecological relationships. The word 'linear' is important - when we use linear models we assume a straight (or linear) relationship between our response variable (also referred to as dependent variables) and our explanatory variables (also referred to as covariates or predictor variables - don't let the terms confuse you).

To understand how they work, it helps to take a quick look at how we formulate linear models mathematically:

 $$y_i = b_0 + b_{1}X_{1i} + \epsilon_i$$
`y_i` is our response variable of interest,
`b_0` is the is the intercept for the linear relationship between y and our explanatory variables (X's), 
`b_1` is the coefficient representing the strength and direction of the relationship between y and X_1
`\epsilon` is the random, unexplained error in our observations around the fitted relationship between y and X(s).

In the above example we only have one explanatory variable (X), but we can have multiple. We would just add on another term, e.g. `b_{2}X_{2i}`. Explanatory variables can be categorical or continuous - we'll see the consequences of that later.

When we're fitting **general** linear models, we assume that `\epsilon`, the error term, is drawn from a normal (i.e., gaussian) distribution. We would expect this if our response variable (y) is continuous and unbounded (could potentially be any number between $-∞$ and $∞$). In the next section, we'll learn how to fit **generalised** linear models which allow us to model non-normal error distributions necessary for count data, for example.

Let's get started with a general linear model. We want to know, are trees in less disturbed sites on average older compared to disturbed sites.

If you took a first year undergrad stats course, you might be thinking, let's use an ANOVA! ANOVA's are just linear models with a categorical predictor variable.

Tree circumference, our response variable (y) of interest, is continuous and we would expect the error distribution to be normally distributed. So we will fit a general linear model.

```{r}
dat <- data.frame(circum = c(rnorm(100, 10), rnorm(100, 20)),
                  site = factor(c(rep('Disturbed', 100), c(rep('Undisturbed', 100)))))

m <- lm(circum ~ site, data = dat)
summary(m)
```
Okay so let's unpack this. [Talk through model output, if time write notes to explain..]

### General linear models

Example: Tree health dataset - species circumference as indication of age?
   - Expect older trees in less disturbed sites?
   - Can use a lm to test

### Frequentist glm - Tree health or Vegetation quadrat 
  - Species richness - is species richness higher in less disturbed sites?
  - Use glm to test
  
- OLS to max likelihoood
- Model checking - residuals
- Plotting and reporting model output

## Day 1 (Afternoon): Complex multivariate models

- Bayesian glm (univariate) - start with same species richness example from previous day, or 
- Bayesian parameter estimation
- max likelihood to MCMC sampling
- Why Bayesian? complex models (e.g., spatial random effects), low sample size and prior information

- multivariate GLM (or wait till day 2 and make it a spatial example?)



